var M=Object.defineProperty;var E=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var k=(i,s,l)=>s in i?M(i,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):i[s]=l,V=(i,s)=>{for(var l in s||(s={}))N.call(s,l)&&k(i,l,s[l]);if(E)for(var l of E(s))O.call(s,l)&&k(i,l,s[l]);return i};var u=(i,s,l)=>new Promise((d,b)=>{var g=m=>{try{f(l.next(m))}catch(a){b(a)}},C=m=>{try{f(l.throw(m))}catch(a){b(a)}},f=m=>m.done?d(m.value):Promise.resolve(m.value).then(g,C);f((l=l.apply(i,s)).next())});import{F as U}from"./Form-CvK45EYM.js";import{u as $}from"./useForm-CPG8etzq.js";import{u as j}from"./useValidator-BjWQ_jvF.js";import{c as q,i as G}from"./index-TwgnzE1J.js";import{g as H}from"./index-DCgAWsuY.js";/* empty css                  */import"./IconPicker-DMkJAgXY.js";/* empty css                        *//* empty css                    *//* empty css               */import{_ as J}from"./AddButtonPermission.vue_vue_type_script_setup_true_lang-mNeg3H_o.js";import{B as K,A as v,z as L,p as W,d as x,J as Q,c as X}from"./element-plus-B5Fb1RnA.js";import{v as Y,r as P,V as _,u as y,M as t,a3 as w,H as I,w as Z,x as ee,y as le}from"./vue-chunks-mpUGqK7y.js";const he=Y({__name:"Write",props:{currentRow:{type:Object,default:()=>null}},setup(i,{expose:s}){const{t:l}=q(),{required:d}=j(),b=i,g=n=>u(this,null,function*(){var o;const e=yield c();p({permissionList:(o=e==null?void 0:e.permissionList)==null?void 0:o.filter(S=>S.value!==n.value)})}),C=n=>u(this,null,function*(){a.value=V({},n)}),f=()=>u(this,null,function*(){var o;const n=yield c(),e=(o=n==null?void 0:n.permissionList)==null?void 0:o.findIndex(S=>S.id===a.value.id);e!==-1&&(n.permissionList[e]=V({},a.value),a.value=null)}),m=P(!1),a=P(null),T=_([{field:"type",label:"菜单类型",component:"RadioButton",value:0,colProps:{span:24},componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1}],on:{change:n=>u(this,null,function*(){const e=yield c();n===1?(r([{field:"component",path:"componentProps.disabled",value:!1}]),p({component:y(h)})):(r([{field:"component",path:"componentProps.disabled",value:!0}]),e.parentId===void 0?p({component:"#"}):p({component:"##"}))})}}},{field:"parentId",label:"父级菜单",component:"TreeSelect",componentProps:{nodeKey:"id",props:{label:"title",value:"id",children:"children"},highlightCurrent:!0,expandOnClickNode:!1,checkStrictly:!0,checkOnClickNode:!0,clearable:!0,on:{change:n=>u(this,null,function*(){var o;const e=yield c();n&&e.type===0?p({component:"##"}):!n&&e.type===0?p({component:"#"}):e.type===1&&p({component:(o=y(h))!=null?o:""})})}},optionApi:()=>u(this,null,function*(){return(yield H()).data.list||[]})},{field:"meta.title",label:l("menu.menuName"),component:"Input"},{field:"component",label:"组件",component:"Input",value:"#",componentProps:{disabled:!0,placeholder:"#为顶级目录，##为子目录",on:{change:n=>{h.value=n}}}},{field:"name",label:l("menu.name"),component:"Input"},{field:"meta.icon",label:l("menu.icon"),component:"Input"},{field:"path",label:l("menu.path"),component:"Input"},{field:"meta.activeMenu",label:l("menu.activeMenu"),component:"Input"},{field:"status",label:l("menu.status"),component:"Select",componentProps:{options:[{label:l("userDemo.disable"),value:0},{label:l("userDemo.enable"),value:1}]}},{field:"permissionList",label:l("menu.permission"),component:"CheckboxGroup",colProps:{span:24},formItemProps:{slots:{default:n=>t(I,null,[t(G,{class:"m-t-5px",type:"primary",size:"small",onClick:()=>m.value=!0},{default:()=>[w("添加权限")]}),t(K,{data:n==null?void 0:n.permissionList},{default:()=>[t(v,{type:"index",prop:"id"},null),t(v,{prop:"value",label:"Value"},{default:({row:e})=>a.value&&a.value.id===e.id?t(L,{modelValue:a.value.value,"onUpdate:modelValue":o=>a.value.value=o,size:"small"},null):t("span",null,[e.value])}),t(v,{prop:"label",label:"Label"},{default:({row:e})=>a.value&&a.value.id===e.id?t(L,{modelValue:a.value.label,"onUpdate:modelValue":o=>a.value.label=o,size:"small"},null):t(W,{class:"mr-1",key:e.value},{default:()=>[e.label]})}),t(v,{label:"Operations",width:"180"},{default:({row:e})=>a.value&&a.value.id===e.id?t(x,{size:"small",type:"primary",onClick:f},{default:()=>[w("确定")]}):t(I,null,[t(x,{size:"small",type:"primary",onClick:()=>C(e)},{default:()=>[w("编辑")]}),t(Q,{title:"Are you sure to delete this?",onConfirm:()=>g(e)},{reference:()=>t(x,{size:"small",type:"danger"},{default:()=>[w("删除")]})})])})]})])}}},{field:"meta.hidden",label:l("menu.hidden"),component:"Switch"},{field:"meta.alwaysShow",label:l("menu.alwaysShow"),component:"Switch"},{field:"meta.noCache",label:l("menu.noCache"),component:"Switch"},{field:"meta.breadcrumb",label:l("menu.breadcrumb"),component:"Switch"},{field:"meta.affix",label:l("menu.affix"),component:"Switch"},{field:"meta.noTagsView",label:l("menu.noTagsView"),component:"Switch"},{field:"meta.canTo",label:l("menu.canTo"),component:"Switch"}]),F=_({component:[d()],path:[d()],"meta.title":[d()]}),{formRegister:R,formMethods:z}=$(),{setValues:p,getFormData:c,getElFormExpose:B,setSchema:r}=z,D=()=>u(this,null,function*(){const n=yield B();if(yield n==null?void 0:n.validate().catch(o=>{}))return yield c()}),h=P("");Z(()=>b.currentRow,n=>{if(!n)return;const e=X(n);h.value=e.type===1?e.component:"",e.parentId===0?r([{field:"component",path:"componentProps.disabled",value:!0}]):r([{field:"component",path:"componentProps.disabled",value:!1}]),e.type===1?r([{field:"component",path:"componentProps.disabled",value:!1}]):r([{field:"component",path:"componentProps.disabled",value:!0}]),p(e)},{deep:!0,immediate:!0}),s({submit:D});const A=n=>u(this,null,function*(){const e=yield c();p({permissionList:[...(e==null?void 0:e.permissionList)||[],n]})});return(n,e)=>(ee(),le(I,null,[t(y(U),{rules:F,onRegister:y(R),schema:T},null,8,["rules","onRegister","schema"]),t(J,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),onConfirm:A},null,8,["modelValue"])],64))}});export{he as _};
